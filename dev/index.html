<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A modelling framework for nested data using the tidymodels 
    ecosystem. Specify how to nest data using the recipes package, create 
    testing and training splits using rsample, and fit models to this data
    using the parsnip and workflows packages. Allows any model to be fit
    to nested data.">
<title>Tidy Modelling for Nested Data • nestedmodels</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tidy Modelling for Nested Data">
<meta property="og:description" content="A modelling framework for nested data using the tidymodels 
    ecosystem. Specify how to nest data using the recipes package, create 
    testing and training splits using rsample, and fit models to this data
    using the parsnip and workflows packages. Allows any model to be fit
    to nested data.">
<meta property="og:image" content="https://ashbythorpe.github.io/nestedmodels/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">nestedmodels</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="articles/nestedmodels.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/nestedmodels-limitations.html">Nestedmodels Limitations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ashbythorpe/nestedmodels/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="nestedmodels-">nestedmodels <a class="anchor" aria-label="anchor" href="#nestedmodels-"></a>
</h1>
</div>
<!-- badges: start -->

<p>The goal of nestedmodels is to allow the modelling of nested data. Some models only accept certain predictors. For panel data, it is often desirable to create a model for each panel. nestedmodels enhances the ‘<a href="https://www.tidymodels.org/" class="external-link">tidymodels</a>’ set of packages by allowing the user to classify a model as ‘nested’.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the released version on CRAN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"nestedmodels"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or install the development version from GitHub:</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ashbythorpe/nestedmodels"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ashbythorpe/nestedmodels" class="external-link">nestedmodels</a></span><span class="op">)</span></span></code></pre></div>
<p>Nested models are often best used on panel data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">example_nested_data</span></span>
<span></span>
<span><span class="va">nested_data</span> <span class="op">&lt;-</span> <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="va">example_nested_data</span>, data <span class="op">=</span> <span class="op">-</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nested_data</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 2</span></span>
<span><span class="co">#&gt;       id data             </span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;list&gt;           </span></span>
<span><span class="co">#&gt;  1     1 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  2     2 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  3     3 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  4     4 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  5     5 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  6     6 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  7     7 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  8     8 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt;  9     9 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 10    10 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 11    11 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 12    12 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 13    13 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 14    14 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 15    15 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 16    16 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 17    17 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 18    18 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 19    19 &lt;tibble [50 × 6]&gt;</span></span>
<span><span class="co">#&gt; 20    20 &lt;tibble [50 × 6]&gt;</span></span></code></pre></div>
<p>The <code><a href="reference/nested_resamples.html">nested_resamples()</a></code> function makes sure that the testing and training data contain every unique value of ‘id’.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">split</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/nested_resamples.html">nested_resamples</a></span><span class="op">(</span><span class="va">nested_data</span>, <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_split</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_tr</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span><span class="va">data_tst</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span></code></pre></div>
<p>Fitting a nested model to this data is very simple.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">parsnip</span><span class="fu">::</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/linear_reg.html" class="external-link">linear_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/nested.html">nested</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">z</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, </span>
<span>           <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span><span class="va">data_tr</span>, data <span class="op">=</span> <span class="op">-</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">data_tst</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 260 × 1</span></span>
<span><span class="co">#&gt;    .pred</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  35.0</span></span>
<span><span class="co">#&gt;  2  27.7</span></span>
<span><span class="co">#&gt;  3  35.0</span></span>
<span><span class="co">#&gt;  4  39.4</span></span>
<span><span class="co">#&gt;  5  30.4</span></span>
<span><span class="co">#&gt;  6  29.5</span></span>
<span><span class="co">#&gt;  7  33.8</span></span>
<span><span class="co">#&gt;  8  33.1</span></span>
<span><span class="co">#&gt;  9  26.3</span></span>
<span><span class="co">#&gt; 10  18.9</span></span>
<span><span class="co">#&gt; # ℹ 250 more rows</span></span></code></pre></div>
<p>If you don’t want to nest your data manually, use <code><a href="reference/step_nest.html">step_nest()</a></code> inside a workflow:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recipe</span> <span class="op">&lt;-</span> <span class="fu">recipes</span><span class="fu">::</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">data_tr</span>, <span class="va">z</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">+</span> <span class="va">id</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/step_nest.html">step_nest</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span> <span class="op">&lt;-</span> <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html" class="external-link">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html" class="external-link">add_model</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html" class="external-link">add_recipe</a></span><span class="op">(</span><span class="va">recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">wf</span>, <span class="va">data_tr</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">wf_fit</span>, <span class="va">data_tst</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 260 × 1</span></span>
<span><span class="co">#&gt;    .pred</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  35.0</span></span>
<span><span class="co">#&gt;  2  27.7</span></span>
<span><span class="co">#&gt;  3  35.0</span></span>
<span><span class="co">#&gt;  4  39.4</span></span>
<span><span class="co">#&gt;  5  30.4</span></span>
<span><span class="co">#&gt;  6  29.5</span></span>
<span><span class="co">#&gt;  7  33.8</span></span>
<span><span class="co">#&gt;  8  33.1</span></span>
<span><span class="co">#&gt;  9  26.3</span></span>
<span><span class="co">#&gt; 10  18.9</span></span>
<span><span class="co">#&gt; # ℹ 250 more rows</span></span></code></pre></div>
<p>Please note that the nestedmodels project is released with a <a href="https://ashbythorpe.github.io/nestedmodels/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=nestedmodels" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ashbythorpe/nestedmodels/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ashbythorpe/nestedmodels/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing nestedmodels</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ashby Thorpe <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3106-099X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active" class="external-link"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active"></a></li>
<li><a href="https://github.com/ashbythorpe/nestedmodels/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/ashbythorpe/nestedmodels/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=nestedmodels" class="external-link"><img src="https://www.r-pkg.org/badges/version/nestedmodels" alt="CRAN status"></a></li>
<li><a href="https://app.codecov.io/gh/ashbythorpe/nestedmodels?branch=main" class="external-link"><img src="https://codecov.io/gh/ashbythorpe/nestedmodels/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ashby Thorpe.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
